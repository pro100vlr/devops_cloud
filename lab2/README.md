| № | Плохая практика                                                 | Почему плохо                                                                                                                                                                                                                         | Как исправлено                                                                                                                                             |
| - | --------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1 | Использование базового образа без версии (`FROM debian`)        | Без указания версии результат сборки становится непредсказуемым: при обновлении базового образа могут измениться пакеты и поведение системы. Кроме того, `debian` — тяжёлый образ, что увеличивает размер контейнера и время сборки. | Использован лёгкий и стабильный базовый образ `alpine:3.11.5`, обеспечивающий воспроизводимость и минимальный размер.                                      |
| 2 | Установка пакетов без фиксации версий                           | Команда `apt-get install -y nginx` всегда установит последнюю доступную версию, что делает сборку нестабильной и не воспроизводимой.                                                                                                 | Добавлена переменная окружения `NGINX_VERSION` и фиксированная установка `nginx=${NGINX_VERSION}`, что гарантирует одинаковый результат при каждой сборке. |
| 3 | Несколько отдельных команд `RUN`                                | Каждая команда `RUN` создаёт новый слой, что делает образ больше и менее оптимальным.                                                                                                                                                | Все операции объединены в одну команду `RUN`, чтобы сократить количество слоёв и ускорить сборку.                                                          |
| 4 | Отсутствие очистки кеша и временных файлов                      | При использовании `apt-get` без очистки кеша остаются временные файлы, увеличивающие размер образа.                                                                                                                                  | Используется установка пакета через `apk add --no-cache`, которая не сохраняет временные файлы.                                                            |
| 5 | Нет переменных окружения для версий и параметров                | Версии пакетов и параметры прописаны напрямую, что затрудняет обновление и поддержку Dockerfile.                                                                                                                                     | Используется переменная окружения `ENV NGINX_VERSION`, позволяющая легко управлять версиями.                                                               |
| 6 | Копирование всех файлов проекта без фильтрации (`COPY . /opt/`) | В контейнер могут попасть ненужные файлы — `.git`, логи, временные каталоги и др., что увеличивает размер образа.                                                                                                                    | Рекомендуется использовать `.dockerignore` для исключения ненужных файлов и директорий.                                                                    |

| Метрика           | Плохой Dockerfile             | Хороший Dockerfile                               |
| ----------------- | ----------------------------- | ------------------------------------------------ |
| Размер образа     | ~120 МБ                       | ~10 МБ                                           |
| Время сборки      | Дольше                        | Быстрее                                          |
| Воспроизводимость | Низкая                        | Высокая                                          |
| Безопасность      | Средняя (root, большой образ) | Выше (минимальный образ, зафиксированные версии) |
| Поддерживаемость  | Сложная                       | Удобная (версии и окружение заданы явно)         |