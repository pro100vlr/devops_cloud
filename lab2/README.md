## Лабораторная работа №2

Выполнила: Просветова Валерия К3241

| № | Плохая практика                                                 | Почему плохо                                                                                                                                                                                                                         | Как исправлено                                                                                                                                             |
| - | --------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1 | Использование базового образа без версии (`FROM debian`)        | Без указания версии результат сборки становится непредсказуемым: при обновлении базового образа могут измениться пакеты и поведение системы. Кроме того, `debian` — тяжёлый образ, что увеличивает размер контейнера и время сборки. | Использован лёгкий и стабильный базовый образ `alpine:3.11.5`, обеспечивающий воспроизводимость и минимальный размер.                                      |
| 2 | Установка пакетов без фиксации версий                           | Команда `apt-get install -y nginx` всегда установит последнюю доступную версию, что делает сборку нестабильной и не воспроизводимой.                                                                                                 | Добавлена переменная окружения `NGINX_VERSION` и фиксированная установка `nginx=${NGINX_VERSION}`, что гарантирует одинаковый результат при каждой сборке. |
| 3 | Несколько отдельных команд `RUN`                                | Каждая команда `RUN` создаёт новый слой, что делает образ больше и менее оптимальным.                                                                                                                                                | Все операции объединены в одну команду `RUN`, чтобы сократить количество слоёв и ускорить сборку.                                                          |
| 4 | Отсутствие очистки кеша и временных файлов                      | При использовании `apt-get` без очистки кеша остаются временные файлы, увеличивающие размер образа.                                                                                                                                  | Используется установка пакета через `apk add --no-cache`, которая не сохраняет временные файлы.                                                            |
| 5 | Нет переменных окружения для версий и параметров                | Версии пакетов и параметры прописаны напрямую, что затрудняет обновление и поддержку Dockerfile.                                                                                                                                     | Используется переменная окружения `ENV NGINX_VERSION`, позволяющая легко управлять версиями.                                                               |
| 6 | Копирование всех файлов проекта без фильтрации (`COPY . /opt/`) | В контейнер могут попасть ненужные файлы — `.git`, логи, временные каталоги и др., что увеличивает размер образа.                                                                                                                    | Рекомендуется использовать `.dockerignore` для исключения ненужных файлов и директорий.                                                                    |

| Метрика           | Плохой Dockerfile             | Хороший Dockerfile                               |
| ----------------- | ----------------------------- | ------------------------------------------------ |
| Размер образа     | ~120 МБ                       | ~10 МБ                                           |
| Время сборки      | Дольше                        | Быстрее                                          |
| Воспроизводимость | Низкая                        | Высокая                                          |
| Безопасность      | Средняя (root, большой образ) | Выше (минимальный образ, зафиксированные версии) |
| Поддерживаемость  | Сложная                       | Удобная (версии и окружение заданы явно)         |

При идеально написанном Dockerfile можно сильно навредить работе контейнерной инфраструктуры. Две плохих практики по работе с контейнерами:

1.Запуск контейнеров с привилегиями root.

Многие запускают контейнеры с флагом --privileged или просто под пользователем root внутри контейнера.Это удобно на первый взгляд, так как не нужно думать о правах доступа, монтировании и т. д.Но на практике:

* Контейнер получает доступ к ядру хоста и всем устройствам.

* Любая уязвимость в приложении даёт возможность выйти за пределы контейнера.

* Нарушаются изоляция и безопасность всей системы.

Плохая практика:

docker run --privileged -d myapp

Хорошая практика:

Запускать контейнер от непривилегированного пользователя (USER в Dockerfile или --user при запуске).

2.Использование контейнеров как постоянное хранилище данных.

Некоторые администраторы хранят данные прямо внутри контейнера, полагая, что он «почти как виртуальная машина».После перезапуска или пересоздания контейнера такие данные исчезают, ведь контейнеры по своей природе эфемерны.

Плохая практика:

docker run -d mydb

Последствия: потеря данных при обновлении контейнера, невозможность масштабирования и резервного копирования.

Хорошая практика:

Использовать тома (volumes) или внешние хранилища, например:

docker run -d -v /data/db:/var/lib/mysql mydb

Добавлю скриншоты к отчету:

Сборка образа "плохого" докерфайла:

<img width="1876" height="715" alt="image (1)" src="https://github.com/user-attachments/assets/7bdeaf0a-3b63-4bbd-a982-e42e25b402a7" />

Запуск контейнера из плохого образа:

<img width="1356" height="78" alt="image (2)" src="https://github.com/user-attachments/assets/f2990f4d-b0d8-4bc1-b0aa-00b3ee08d358" />

Сборка образа хорошего докерфайла:

<img width="1881" height="645" alt="image (3)" src="https://github.com/user-attachments/assets/35f8eb95-3a61-4fc0-9482-afd5b31e0f44" />

Запуск контейнера хорошего докерфайла:

<img width="1356" height="75" alt="image (4)" src="https://github.com/user-attachments/assets/cd16e38a-326b-452f-a66c-49ab0b9982c3" />

Nginx успешно запускается из обоих контейнеров на портах 8080 и 8081:

<img width="1900" height="629" alt="image (5)" src="https://github.com/user-attachments/assets/3d56a18d-20d7-41e9-ad47-1e07f15e646d" />

<img width="1909" height="580" alt="image (6)" src="https://github.com/user-attachments/assets/f2ad5ae1-cd6f-4671-8ce2-3c1f4b9c0f2c" />

Наглядное сравнение по используемой памяти образов хорошего и плохого докерфайла (колонка SIZE):

<img width="1480" height="122" alt="image (7)" src="https://github.com/user-attachments/assets/64e4b825-9092-443b-b5a7-75055acc325a" />

Вывод: В работе я сравнила “плохой” и “хороший” Dockerfile и на практике увидела, как нарушения базовых практик приводят к избыточному размеру образа, большему числу слоёв, уязвимостям и нестабильным сборкам. После внесённых исправлений сборка стала более стабильной, а безопасность контейнера значительно повысилась. Дополнительно я разобрала ошибки эксплуатации контейнеров и показала, как их избегать. В итоге сформировала чёткое понимание, что качество результата зависит не только от Dockerfile, но и от дисциплины в работе с контейнерами на проде.
